@model List<Product>
@{
    Layout = "/Areas/Wholesaler/Views/Shared/_Layout.cshtml";
}
@section styles{
<link href="~/assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/bootstrap.min.css" rel="stylesheet" type="text/css" />
     <link rel="stylesheet" type="text/css" href="~/assets/plugins/select2/select2_metro.css" />
    <link rel="stylesheet" href="~/assets/plugins/data-tables/DT_bootstrap.css" />
    <style type="text/css">
        #SellingTable_filter {
            margin-right: 100px;
        }
        #SellingTable_length {
            margin-left:50px;
        }
        .pagination .prev a {
            height: 22px;
        }

        .pagination .next a {
            height: 22px;
        }
    </style>
}
<!--60px占高层-->
<div class="h60"></div>
<div class="part">
    <p class="position">◆当前位置：线路管理</p>
    <!--公司信息板块-->
    <div class="company_total">
        <img class="company_logo" src="/images/625185514.png">
        <div class="company_infor">
            <div class="company_infor_up">
                <p class="company_infor_name">
                    @FenXiao.Web.Common.FenXiaoUserContext.Current.UserInfo.Company.CompanyName
                    <span class="company_type">账号类别：<span class="details_type">@FenXiao.Web.Common.FenXiaoUserContext.Current.CompanyType</span></span>
                </p>
            </div>
            <div class="company_infor_down">
                <span class="company_member">总路线：<span class="f-lightblue">@(Model.Count)</span></span>
                
            </div>
        </div>
    </div>

    <!--路线管理板块-->
    <div class="line_manage">
        <div class="line_manage_nav" id="ManageNav">
            <ul>
                <li data-val="SellingLuXian" class="choosed" id="Selling"><a href="/Wholesaler/WHome/MyLuXian"><span>正在出售路线</span></a> </li>
                <li data-val="SelledLuXian"  id="Past"><a href="/Wholesaler/WHome/MySelledLuXian"><span>已截止线路</span></a> </li>
                <li data-val="AllLuXian" id="Cancel"><a href="/Wholesaler/WHome/MyAllLuxian"><span>全部路线</span></a> </li>
            </ul>
        </div>
        <div class="line_manage_infor" id="ManageInfor">
            <div class="h30"></div>
            <!--正在出售-->
            <table class="table" id="SellingTable">
                <thead>
                    <tr>
                        <th>#序号</th>
                        <th>线路名称</th>
                        <th>发团日期</th>
                        <th>同行价格</th>
                        <th>剩余量/总数量</th>
                        <th>相应操作</th>
                        <th>相应操作</th>
                    </tr>
                </thead>
                <tbody class="fs08 tcenter">
                    @*@foreach (var item in Model)
                    {
                        if (item.State == (int)EnumProduct.zhengchang &&DateTime.Compare(item.SendGroupTime,DateTime.Now)>0)
                        {
                            <tr>
                                <td>@item.Id</td>
                                <td>@item.Name</td>
                                <td>@item.SendGroupTime</td>
                                <td>@item.ErTongPrice / @item.ChengRenPrice</td>
                                <td>@item.RemainCount/@item.Count</td>
                                <td>
                                    <a href="/Wholesaler/WHome/LuXianmanagement?ProductId=@item.Id"><span class="company_btn"><i class="i-manage"></i>查看</span></a>
                                    <span class="company_btn moreaction_btn">更多操作<i class="i-more"></i> </span>
                                    <div class="table_moreaction" id="TableMoreAction">
                                        <img src="/images/top-arrow.png">
                                        <ul>
                                            <li><a href="/Wholesaler/WHome/EditLuXian/@item.Id">修改数量</a> </li>
                                            <li><a href="/Wholesaler/WHome/EditLuXian/@item.Id">编辑线路</a> </li>
                                            <li><a href="/Wholesaler/WHome/MyLuXianDetail/@item.Id">路线详情</a> </li>
                                            <li><a href="javascript:;" onclick="cancleLuxian(@item.Id);" style="cursor:pointer">截止报名</a></li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        }
                    }*@
                </tbody>
            </table>
            <!--已截止-->
            <table class="table" id="PastTable">
                <thead>
                    <tr>
                        <th>#序号</th>
                        <th>线路名称</th>
                        <th>发团日期</th>
                        <th>同行价格</th>
                        <th>剩余量/总数量</th>
                        <th>相应操作</th>
                    </tr>
                </thead>
                <tbody class="fs08 tcenter">
                    @*@foreach (var item in Model)
                    {
                        if (item.State == (int)EnumProduct.zhengchang && DateTime.Compare(item.SendGroupTime, DateTime.Now) <= 0)
                        {
                            <tr>
                                <td>@item.Id</td>
                                <td>@item.Name</td>
                                <td>@item.SendGroupTime</td>
                                <td>@item.ErTongPrice / @item.ChengRenPrice</td>
                                <td>@item.RemainCount/@item.Count</td>
                                <td>
                                    <a href="/Wholesaler/WHome/LuXianmanagement?ProductId=@item.Id">
                                        <span class="company_btn"><i class="i-manage"></i>查看</span>
                                    </a> 
                                    <span class="company_btn moreaction_btn">更多操作<i class="i-more"></i> </span>
                                    <div class="table_moreaction" id="TableMoreAction">
                                        <img src="/images/top-arrow.png">
                                        <ul>
                                            <li><a href="/Wholesaler/WHome/MyLuXianDetail/@item.Id">路线详情</a> </li>
                                            <li><a href="javascript:;" onclick="cancleLuxian(@item.Id);" style="cursor:pointer">截止报名</a></li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        }
                    }*@
                </tbody>
            </table>
            <!--所有-->
            <table class="table" id="CancelTable">
                <thead>
                    <tr>
                        <th>#序号</th>
                        <th>线路名称</th>
                        <th>原定发团日期</th>
                        <th>同行价格</th>
                        <th>剩余量/总数量</th>
                        <th>相应操作</th>
                    </tr>
                </thead>
                <tbody class="fs08 tcenter">
                    @*@foreach (var item in Model)
                    {
                        if (item.State == (int)EnumProduct.jinyong)
                        {
                            <tr>
                                <td>@item.Id</td>
                                <td>@item.Name</td>
                                <td>@item.SendGroupTime</td>
                                <td>@item.ErTongPrice/@item.ChengRenPrice</td>
                                <td>
                                    <a href="/Wholesaler/WHome/LuXianmanagement?ProductId=@item.Id">
                                        <span class="company_btn"><i class="i-manage"></i>查看</span>
                                        </a>
                                        <span class="company_btn moreaction_btn">更多操作<i class="i-more"></i> </span>
                                        <div class="table_moreaction" id="TableMoreAction">
                                            <img src="/images/top-arrow.png">
                                            <ul>
                                                <li><a href="/Wholesaler/WHome/EditLuXian/@item.Id">修改数量</a> </li>
                                                <li><a href="/Wholesaler/WHome/MyLuXianDetail/@item.Id">路线详情</a> </li>
                                                <li><a href="javascript:;" onclick="recoverLuXian(@item.Id);" style="cursor:pointer">恢复路线</a></li>
                                            </ul>
                                        </div>
</td>
                            </tr>
                        }
                    }*@
                </tbody>
            </table>
        </div>
    </div>
</div>	

@section scripts{
<script src="~/assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script type="text/javascript" src="~/assets/plugins/select2/select2.min.js"></script>
<script type="text/javascript" src="~/assets/plugins/data-tables/jquery.dataTables.js"></script>
<script type="text/javascript" src="~/assets/plugins/data-tables/DT_bootstrap.js"></script>
<script type="text/javascript" charset="utf-8">
    var tbl;
    $(document).ready(function () {
        tbl = $('#SellingTable').dataTable({
            "oLanguage": {//语言国际化
                //"sUrl": "/Scripts/Plug-in/jquery.dataTable.cn.txt"
                "sProcessing": '<i class="fa fa-coffee"></i>&nbsp;请稍后...',
            },
            "bDestroy":true,
            "bRetrieve": true,
            "bAutoWidth":true,
            "bJQueryUI": false,
            "sPaginationType": "bootstrap",
            'bPaginate': true,  //是否分页。
            "bProcessing": true, //当datatable获取数据时候是否显示正在处理提示信息。
            "bServerSide": false,
            "sAjaxSource": "/Wholesaler/WHome/SellingLuXian",
            "iDisplayLength": 50,
            "aoColumns": [
                            { "sTitle": "#序号" },
                            { "sTitle": "线路名称" },
                            { "sTitle": "发团日期" },
                            { "sTitle": "同行价格" },
                            { "sTitle": "剩余量/总数量" },
                            {
                                "sTitle": "相应操作",
                                "sClass": "center",
                                "fnRender": function (obj) {
                                    return ' <a href="/Wholesaler/WHome/LuXianmanagement?ProductId=' + obj.aData[0] + '"><span class="company_btn"><i class="i-manage"></i>查看</span></a>';
                                }
                            },
                            {
                                "sTitle": "更多操作",
                                "sClass": "center",
                                "fnRender": function (obj) {
                         return  '<span class="company_btn moreaction_btn" onClick="javascripts:ClickMoreAction(this);">更多操作<i class="i-more"></i> </span>\
                                    <div class="table_moreaction" id="TableMoreAction">\
                                        <img src="/images/top-arrow.png">\
                                        <ul>\
                                            <li><a href="/Wholesaler/WHome/EditCount/' + obj.aData[0] + '">修改数量</a> </li>\
                                            <li><a href="/Wholesaler/WHome/EditLuXian/' + obj.aData[0] + '">编辑线路</a> </li>\
                                            <li><a href="/Wholesaler/WHome/MyLuXianDetail/' + obj.aData[0] + '">路线详情</a> </li>\
                                            <li><a href="javascript:;" onclick="cancleLuxian(' + obj.aData[0] + ');" style="cursor:pointer">截止报名</a></li>\
                                            <li><a href="javascript:;" onClick="javascripts:CloseMoreAction(this);"style="cursor:pointer">关闭</a></li>\
                                        </ul>\
                                    </div>';
                            }
                    }
            ],
            "fnDrawCallback": function () {

            }
        });
    });

    function RefreshTable(tableId, urlData) {
        $.getJSON(urlData, null, function (json) {
            table = $(tableId).dataTable();
            oSettings = table.fnSettings();
            
            table.fnClearTable(this);
            for (var i = 0; i < json.aaData.length; i++) {
                table.oApi._fnAddData(oSettings, json.aaData[i]);
            }
            oSettings.aiDisplay = oSettings.aiDisplayMaster.slice();
            table.fnDraw();
        });
    }
    //========================
    //线路管理： Tab选项卡切换
    //========================
    $("#ManageNav ul li").click(function () {
        $("#ManageNav ul li").removeClass("choosed");
        $(this).addClass("choosed");
        var _no = $(this).index();
        table = $("#SellingTable").dataTable();
        oSettings = table.fnSettings();
        table.fnDestroy();
        //table.fnClearTable(this);
        $("#SellingTable").css("display", "none");
        $("#ManageInfor").append('<p align="center">正在加载</p>');
        //$("#ManageInfor").find("table").css("display", "none");
        //$("#ManageInfor").find("table").eq(_no).css("display", "table");
    });

</script>

<script type="text/javascript">
        function cancleLuxian(_id) {
            $.ajax(
                {
                    url: "/Wholesaler/WHome/CancelLuXian",
                    type: "POST",
                    data:
                        {
                            id: _id,
                            
                        },
                    beforeSend: function (XMLHttpRequest) {
                    },
                    success: function (data, textStatus) {
                        var res = $.parseJSON(data);
                        if (res.Ok == "1") {
                            location.reload()
                        } else {
                            alert(res.Msg);
                        }
                    },
                    complete: function (XMLHttpRequest, textStatus) {
                    },
                    error: function () {
                        alert("好像出错了，请刷新页面重试");
                    }
                })
        }

        function recoverLuXian(_id)
        {
            $.ajax(
               {
                   url: "/Wholesaler/WHome/RecoverLuXian",
                   type: "POST",
                   data:
                       {
                           id: _id,
                            
                       },
                   beforeSend: function (XMLHttpRequest) {
                   },
                   success: function (data, textStatus) {
                       var res = $.parseJSON(data);
                       if (res.Ok == "1") {
                           location.reload()
                       } else {
                           alert(res.Msg);
                       }
                   },
                   complete: function (XMLHttpRequest, textStatus) {
                   },
                   error: function () {
                       alert("好像出错了，请刷新页面重试");
                   }
               })
        }
    </script>

<script type="text/javascript">
        $("#Menu").children("li").eq(0).removeClass("active");
        $("#Menu").children("li").eq(1).removeClass("active");
        $("#Menu").children("li").eq(2).removeClass("active");
        $("#Menu").children("li").eq(3).removeClass("active");
        $("#Menu").children("li").eq(4).removeClass("active");
        $("#Menu").children("li").eq(5).removeClass("active");
        $("#Menu").children("li").eq(1).addClass("active");
    </script>

    }