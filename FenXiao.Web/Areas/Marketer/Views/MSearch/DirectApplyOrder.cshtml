@section title{
    <title>零售商-搜索线路-直接下单</title>
}
@using FenXiao.Model
@model Product
<!--60px占高层-->
<div class="h60"></div>
<div class="part">
    <p class="position">◆当前位置：搜索线路 >> 直接下单</p>
    <!--搜索结果区域-->
    <div class="search_input_result_tab">
        <p>直接下单订单</p>
    </div>
    <div class="line_details_title">
        @Html.Action("ProductInfo", new { ProductId = ViewBag.ProductId })
        <div class="h20 clear"></div>
        <hr />
        <div class="order_input">
            <input hidden="hidden" id="Id" name="Id" value="@(ViewBag.ProductId)" />
            <p class="single">预定成人票数量：<input id="ChengRenCount" name="ChengRenCount" type="text" value="0">份</p>
            <p class="single">预定儿童票数量：<input id="ErTongCount" name="ErTongCount" type="text" value="0">份</p>
            <p class="single"><span id="submit" class="btn_sub">提交订单</span></p>
        </div>
    </div>
</div>
<!--/part结束-->
@section scripts{
    @*侧边栏切换焦点操作*@
    <script type="text/javascript">
        LeftMenuSelect(0);
    </script>
    @*提交订单操作*@
    <script type="text/javascript">
        $("#submit").click(function () {
            @*数据效验*@
            if (isNaN($("#ChengRenCount").val()) || $("#ChengRenCount").val() < 0)
            {
                alert("成人的数量不能非数字或为负数！");
                $("#ChengRenCount").focus();
                return;
            }
            else if (isNaN($("#ErTongCount").val()) || $("#ErTongCount").val() < 0)
            {
                alert("儿童的数量不能非数字或为负数！");
                $("#ErTongCount").focus();
                return;
            }
            else if ($("#ChengRenCount").val() ==0 && $("#ErTongCount").val()==0)
            {
                alert("成人与儿童的数量不能同时为零！");
                $("#ChengRenCount").focus();
                return;
            }
            @*发送Ajax请求*@
            $.ajax(
                     {
                         url: "/Marketer/MSearch/DirectApplyOrderAjax",
                         type: "POST",
                         data:
                             {
                                 Id: $("#Id").val(),
                                 ChengRenCount: $("#ChengRenCount").val(),
                                 ErTongCount: $("#ErTongCount").val()
                             },
                         beforeSend: function (XMLHttpRequest) {
                             $("#submit").html("正在提交，请不要关闭页面");
                             $("#submit").addClass('stop');
                         },
                         success: function (data) {
                             if (data.Ok == "200") {
                                alert("订单提交成功");
                                var objs = eval('(' + data.Msg + ')');
                                window.location.href = '/Marketer/MSearch/CreateMember?OrderFormId=' + objs.OrderFormId + '&MessageId=' + objs.MessageId;
                             }
                             else if (data.Ok == "300") {
                                 alert("该线路已被禁用");
                                 location.reload(true);
                             }
                             else if (data.Ok == "100") {
                                 alert("数量超出");
                                 location.reload(true);
                             } else {
                                 alert("未知原因出错");
                                 location.reload(true);
                             }                            
                         },
                         error: function () {
                             alert("好像出错了，确认后自动刷新该页面");
                             location.reload(true);
                         }
                     })
        });
    </script>
}